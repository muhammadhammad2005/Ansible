---
- name: Install and Configure Apache Web Server
  hosts: webservers
  become: yes

  vars:
    apache_package: httpd
    apache_service: httpd
    document_root: /var/www/html

  tasks:
    - name: Install Apache and tools
      yum:
        name:
          - httpd
          - firewalld
          - curl
          - vim
        state: present
      tags: install

    - name: Start and enable firewalld
      systemd:
        name: firewalld
        state: started
        enabled: yes
      tags: firewall

    - name: Allow HTTP service in firewall
      ansible.posix.firewalld:
        service: http
        permanent: yes
        state: enabled
        immediate: yes
      tags: firewall

    - name: Ensure document root exists
      file:
        path: "{{ document_root }}"
        state: directory
        owner: apache
        group: apache
        mode: "0755"
      tags: configure

    - name: Start and enable Apache
      systemd:
        name: "{{ apache_service }}"
        state: started
        enabled: yes
      tags: service

    - name: Verify Apache is listening on port 80
      wait_for:
        host: 127.0.0.1
        port: 80
        timeout: 10
      tags: verify

